// Stress test: Complex function calls and recursion
// Expected: 139
fn factorial(n: i32) -> i32 {
    if n <= 1 {
        return 1;
    } else {
        return n * factorial(n - 1);
    }
}

fn fibonacci(n: i32) -> i32 {
    if n <= 1 {
        return n;
    } else {
        return fibonacci(n - 1) + fibonacci(n - 2);
    }
}

fn add(a: i32, b: i32) -> i32 {
    return a + b;
}

fn multiply(a: i32, b: i32) -> i32 {
    return a * b;
}

fn chain(x: i32) -> i32 {
    return add(multiply(x, 2), 10);
}

fn main() -> i32 {
    // Simple recursion
    let fact3: i32 = factorial(3);  // 6
    let fact4: i32 = factorial(4);  // 24
    
    // Fibonacci
    let fib5: i32 = fibonacci(5);  // 5
    let fib6: i32 = fibonacci(6);  // 8
    
    // Function composition
    let chain_result: i32 = chain(5);  // (5 * 2) + 10 = 20
    
    // Nested function calls
    let nested: i32 = add(multiply(2, 3), multiply(4, 5));  // 6 + 20 = 26
    
    // Functions in loops
    let mut sum: i32 = 0;
    for i in 1..5 {
        sum = sum + add(i, i * 2);  // (1+2) + (2+4) + (3+6) + (4+8) = 3 + 6 + 9 + 12 = 30
    }
    
    // Functions in conditionals
    let cond_result: i32 = if multiply(2, 3) > 5 {
        add(10, 10)  // 20
    } else {
        add(5, 5)
    };
    
    return fact3 + fact4 + fib5 + fib6 + chain_result + nested + sum + cond_result;
    // 6 + 24 + 5 + 8 + 20 + 26 + 30 + 20 = 139
}
